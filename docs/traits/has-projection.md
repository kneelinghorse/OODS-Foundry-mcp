# HasProjection Trait

The HasProjection trait specifies the geographic projection system used to map coordinates to screen space. It enables visualization of geographic data using various map projections with configurable parameters.

## Overview

| Property | Value |
|----------|-------|
| **Trait ID** | `viz.spatial.HasProjection` |
| **Category** | `viz.spatial` |
| **Family** | Layout |
| **Version** | 1.0.0 |

## Purpose

The HasProjection trait serves two primary purposes:

1. **Projection Selection**: Choose the appropriate map projection for the geographic region and visualization type
2. **Projection Configuration**: Configure projection parameters (center, scale, rotation, clipping) to optimize the map view

## Use Cases

- **World Maps**: Use `equalEarth` or `naturalEarth1` for equal-area world visualizations
- **US Maps**: Use `albersUsa` for US-centric maps with Alaska and Hawaii insets
- **Street-Level Maps**: Use `mercator` for web-standard conformal projections
- **Regional Maps**: Use `conicEqualArea` for regional maps that preserve area
- **Globe Views**: Use `orthographic` for 3D globe perspective visualizations

## Supported Projection Types

### Mercator
- **Use Case**: Web standard, street-level maps, navigation
- **Properties**: Conformal (preserves angles), standard for web mapping
- **Best For**: Global maps, street-level detail, web applications

### Albers USA
- **Use Case**: United States maps with Alaska and Hawaii
- **Properties**: Equal-area, optimized for US geography
- **Best For**: US state-level visualizations, demographic maps

### Equal Earth
- **Use Case**: Modern world maps with equal-area properties
- **Properties**: Equal-area, aesthetically pleasing
- **Best For**: Thematic world maps, data visualization

### Orthographic
- **Use Case**: Globe views, 3D perspective
- **Properties**: Perspective projection, shows hemisphere
- **Best For**: Global overviews, interactive globe visualizations

### Conic Equal Area
- **Use Case**: Regional maps, mid-latitude regions
- **Properties**: Equal-area, preserves area relationships
- **Best For**: Regional analysis, area-based comparisons

### Natural Earth 1
- **Use Case**: General-purpose world maps
- **Properties**: Compromise projection, balanced distortion
- **Best For**: General world maps, educational visualizations

## Parameters

### projectionType
- **Type**: `enum`
- **Default**: `mercator`
- **Values**: `mercator`, `albersUsa`, `equalEarth`, `orthographic`, `conicEqualArea`, `naturalEarth1`
- **Description**: Type of geographic projection to use

### center
- **Type**: `[number, number]` (JSON string)
- **Default**: `[0, 0]`
- **Description**: Center point of the projection as `[longitude, latitude]` array
- **Example**: `[-95, 40]` for US center

### scale
- **Type**: `number`
- **Default**: `100`
- **Minimum**: `1`
- **Description**: Scale factor for the projection. Higher values zoom in, lower values zoom out

### rotate
- **Type**: `[number, number, number]` (JSON string)
- **Default**: `[0, 0, 0]`
- **Description**: Rotation angles as `[lambda, phi, gamma]` array
- **Example**: `[10, 20, 30]` for rotated view

### clipExtent
- **Type**: `[[number, number], [number, number]]` (JSON string)
- **Default**: None
- **Description**: Clip extent as `[[x0, y0], [x1, y1]]` array to limit visible area
- **Example**: `[[-180, -90], [180, 90]]` for full world

## Schema Fields

### projection_type
The type of geographic projection (required, default: `mercator`)

### projection_center
Center point as JSON array `[longitude, latitude]` (optional, default: `[0, 0]`)

### projection_scale
Scale factor for the projection (optional, default: `100`, minimum: `1`)

### projection_rotate
Rotation angles as JSON array `[lambda, phi, gamma]` (optional, default: `[0, 0, 0]`)

### projection_clip_extent
Clip extent as JSON array `[[x0, y0], [x1, y1]]` (optional)

### projection_config
Renderer-specific projection configuration (generated automatically)

## Output Properties

### projectionConfig
- **Type**: `object`
- **Description**: Renderer-specific projection configuration
- **Generated By**: `projection-config-generator` utility
- **Renderer Support**: Vega-Lite, ECharts

## Examples

### US Map with Albers USA Projection

```typescript
{
  projection_type: 'albersUsa',
  projection_center: '[-95, 40]',
  projection_scale: 1000
}
```

### World Map with Equal Earth Projection

```typescript
{
  projection_type: 'equalEarth',
  projection_center: '[0, 0]',
  projection_scale: 150
}
```

### Regional Map with Conic Equal Area

```typescript
{
  projection_type: 'conicEqualArea',
  projection_center: '[-100, 45]',
  projection_scale: 500,
  projection_rotate: '[0, 0, 0]'
}
```

## Integration with Other Traits

### Geocodable
The HasProjection trait works with Geocodable to:
- Project detected geographic coordinates to screen space
- Apply appropriate projection based on detected region type
- Handle both point and boundary data

### LayeredOverlay
The HasProjection trait works with LayeredOverlay to:
- Apply projection to all map layers consistently
- Ensure proper coordinate transformation for all overlay layers
- Maintain projection settings across layer composition

## Renderer Compatibility

### Vega-Lite
- Native support for all projection types
- Uses `projection` property in spec
- Supports `center`, `scale`, `rotate`, `clipExtent` parameters

### ECharts
- Native support via `geo` component
- Uses `projection` property
- Converts scale to zoom automatically
- Supports `center`, `zoom`, `rotate`, `boundingCoords` parameters

## Best Practices

1. **Choose Appropriate Projection**: Select projection based on geographic region and visualization purpose
2. **Set Center Point**: Always set center to the region of interest for better view
3. **Adjust Scale**: Use scale to zoom to appropriate level for data detail
4. **Consider Area Preservation**: Use equal-area projections for area-based comparisons
5. **Test Across Renderers**: Verify projection appearance in both Vega-Lite and ECharts

## Accessibility

- Projection settings must be accessible via keyboard navigation
- Screen reader announcements for projection type changes
- High contrast support for projection controls
- See: A11Y-R-04

## References

- [Spatial Module Architecture](../../../cmos/foundational-docs/data-viz-part2/spatial-module/ARCHITECTURE.md)
- [Mission B31.3](../../../cmos/missions/B31.3-projection-overlay-traits.yaml)
- [d3-geo Projections](https://github.com/d3/d3-geo#projections)

