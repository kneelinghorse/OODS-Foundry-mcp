import { Meta } from '@storybook/blocks';

<Meta title="Understanding OODS/Core Concepts" />

# Core Concepts

**Objects, Traits, and Contexts — The Building Blocks of OODS**

---

## Objects: Your Domain Entities

Objects are the **nouns** of your application—the business entities that users interact with. In OODS, an object is more than a data structure. It's a self-describing entity that knows:

- What data it contains (schema)
- What capabilities it has (traits)
- How to render in different situations (view extensions)
- What design tokens to apply (semantic tokens)

### Example Objects

| Object | Description | Common Traits |
|--------|-------------|---------------|
| **User** | A person in your system | Addressable, Authable, Preferenceable, Timestampable |
| **Organization** | A company or team | Addressable, Authable, Ownerable |
| **Product** | Something you sell | Classifiable, Priceable, Timestampable |
| **Invoice** | A billing document | Stateful, Billable, Timestampable |
| **Subscription** | Recurring service agreement | Stateful, Billable, Cancellable, Metered |
| **Article** | Content entity | Labelled, Stateful, Ownerable, Timestampable |

### Object Definition

Objects are defined declaratively. Here's a simplified User object:

```yaml
object:
  name: User
  version: 1.0.0
  description: A person with an account in the system

traits:
  - Timestampable
  - Addressable:
      roles: [billing, shipping]
      defaultRole: billing
  - Authable:
      roleStrategy: rbac
  - Preferenceable:
      categories: [notifications, privacy, display]

schema:
  id:
    type: uuid
    required: true
  email:
    type: email
    required: true
  display_name:
    type: string
    required: true
```

**Key insight:** Objects *compose* traits—they don't inherit from them. A User isn't a "kind of" Addressable entity. A User *has* the Addressable capability, along with whatever other capabilities it needs.

---

## Traits: Composable Capabilities

Traits are the **adjectives** of OODS—reusable capabilities that objects can have. When an object composes a trait, it gains:

- **Schema fields** — Data structure additions
- **UI components** — Rendering instructions per context
- **Design tokens** — Semantic styling
- **Validation rules** — Data integrity constraints
- **Actions** — Operations the object can perform

### Trait Categories

<div style={{ marginTop: '1rem' }}>

#### Core Traits
Fundamental capabilities most business objects need.

| Trait | Capability | Example Fields |
|-------|------------|----------------|
| **Addressable** | Has physical/mailing addresses | `addresses`, `default_address_role` |
| **Authable** | Has roles and permissions | `roles`, `permissions`, `access_level` |
| **Classifiable** | Belongs to categories/hierarchies | `categories`, `primary_category` |
| **Communicable** | Can send/receive messages | `channels`, `preferences`, `history` |
| **Preferenceable** | Has user-configurable settings | `preferences`, `preference_schema` |

#### Lifecycle Traits
Manage state transitions and temporal aspects.

| Trait | Capability | Example Fields |
|-------|------------|----------------|
| **Stateful** | Has lifecycle status | `status`, `state_history` |
| **Timestampable** | Tracks creation/modification | `created_at`, `updated_at` |
| **Archivable** | Can be archived/restored | `archived_at`, `archived_by` |
| **Cancellable** | Supports cancellation flow | `canceled_at`, `cancellation_reason` |

#### Domain Traits (SaaS Billing)
Specialized traits for billing and commerce.

| Trait | Capability | Example Fields |
|-------|------------|----------------|
| **Billable** | Can generate charges | `billing_schedule`, `amount_due` |
| **Payable** | Can receive payments | `payment_method`, `payment_history` |
| **Refundable** | Supports refunds | `refund_policy`, `refund_history` |
| **Metered** | Tracks usage-based billing | `usage_records`, `usage_aggregation` |

</div>

### Trait Definition

Here's the `Stateful` trait that manages lifecycle status:

```yaml
trait:
  name: Stateful
  version: 1.0.0
  description: Normalizes lifecycle state transitions
  category: lifecycle

parameters:
  - name: states
    type: string[]
    required: true
    default: [draft, active, paused, archived]
  - name: initialState
    type: string
    default: draft

schema:
  status:
    type: string
    required: true
    validation:
      enumFromParameter: states
  state_history:
    type: StateTransition[]
    default: []

view_extensions:
  list:
    - component: StatusBadge
      props:
        field: status
  detail:
    - component: StatusTimeline
      position: top
      props:
        field: status
        historyField: state_history
  form:
    - component: StatusSelector
      props:
        field: status
        optionsParameter: states

tokens:
  status.state.default.bg: "var(--status-neutral-bg)"
  status.state.default.text: "var(--status-neutral-text)"
```

**Key insight:** Traits bring *everything* needed for a capability—not just data, but UI hints, tokens, and validation. When a User composes Stateful, it automatically knows how to render status badges in lists, timelines in detail views, and selectors in forms.

---

## Contexts: Rendering Situations

Contexts are the **verbs** of OODS—the situations where objects appear. The same User object renders differently based on context:

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem', marginTop: '1.5rem', marginBottom: '1.5rem' }}>
  <div style={{ padding: '1rem', border: '1px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.5rem 0' }}>List Context</h4>
    <p style={{ margin: 0, fontSize: '0.875rem' }}>
      Compact row showing essential info: name, status badge, primary action. Optimized for scanning.
    </p>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.5rem 0' }}>Detail Context</h4>
    <p style={{ margin: 0, fontSize: '0.875rem' }}>
      Full page showing all fields, all traits, activity timeline. Optimized for comprehension.
    </p>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.5rem 0' }}>Form Context</h4>
    <p style={{ margin: 0, fontSize: '0.875rem' }}>
      Editable fields with validation, trait-specific editors like address pickers. Optimized for input.
    </p>
  </div>
  <div style={{ padding: '1rem', border: '1px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.5rem 0' }}>Timeline Context</h4>
    <p style={{ margin: 0, fontSize: '0.875rem' }}>
      Chronological view of state changes, interactions, and events. Optimized for history.
    </p>
  </div>
</div>

### Canonical Contexts

These are the foundational rendering situations that most applications need:

| Context | Purpose | Typical Use |
|---------|---------|-------------|
| **Detail** | Full entity view | Profile pages, record views |
| **List** | Multiple items scanning | Tables, search results, feeds |
| **Form** | Data entry/editing | Create/edit modals, settings pages |
| **Timeline** | Historical sequence | Activity logs, audit trails |

### Compound Contexts

Built from canonical contexts for specific UI patterns:

| Context | Composition | Typical Use |
|---------|-------------|-------------|
| **Card** | Detail (condensed) | Dashboard widgets, previews |
| **Inline** | List (minimal) | Mentions, references, chips |
| **Chart** | List (aggregated) | Dashboards, analytics |
| **Dashboard** | Multiple contexts | Overview screens |

---

## How They Connect

The power of OODS emerges when Objects, Traits, and Contexts work together:

<div style={{ padding: '1.5rem', background: 'var(--color-bg-subtle)', borderRadius: '8px', marginTop: '1.5rem', marginBottom: '1.5rem' }}>
  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '1rem', flexWrap: 'wrap', fontFamily: 'monospace', fontSize: '0.875rem' }}>
    <span style={{ padding: '0.5rem 1rem', background: 'var(--color-bg-default)', borderRadius: '4px', border: '1px solid var(--color-border-default)' }}>Object (User)</span>
    <span>+</span>
    <span style={{ padding: '0.5rem 1rem', background: 'var(--color-bg-default)', borderRadius: '4px', border: '1px solid var(--color-border-default)' }}>Traits (Addressable, Stateful)</span>
    <span>→</span>
    <span style={{ padding: '0.5rem 1rem', background: 'var(--color-bg-default)', borderRadius: '4px', border: '1px solid var(--color-border-default)' }}>Compositor</span>
    <span>→</span>
    <span style={{ padding: '0.5rem 1rem', background: 'var(--color-bg-default)', borderRadius: '4px', border: '1px solid var(--color-border-default)' }}>Context (List)</span>
    <span>→</span>
    <span style={{ padding: '0.5rem 1rem', background: 'var(--color-primary-subtle)', borderRadius: '4px', border: '1px solid var(--color-primary-emphasis)' }}>Rendered UI</span>
  </div>
</div>

1. **Define the Object** — "A User has email, display_name, and composes Addressable + Stateful traits"

2. **Traits Contribute** — Addressable adds `addresses` field and address UI components. Stateful adds `status` field and status badges.

3. **Compositor Merges** — The Trait Engine merges all trait contributions, resolving any conflicts (what if two traits define the same field?)

4. **Context Selects** — Place the User in a List context. The compositor picks the `list` view extensions from each trait.

5. **UI Renders** — The List shows: user name, status badge (from Stateful), address summary (from Addressable)

**The magic:** Change to a Detail context, and the same User now shows a full address panel, status timeline, and all other trait contributions appropriate for detail views. *You didn't write two different components.* You placed the same object in two different contexts.

---

## Practical Example: Same User, Four Contexts

Imagine displaying the same User object in different parts of your application:

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '1rem', marginTop: '1rem' }}>
  <div style={{ padding: '1rem', border: '2px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.75rem 0', color: 'var(--color-text-muted)' }}>List Context</h4>
    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.5rem', background: 'var(--color-bg-default)', borderRadius: '4px' }}>
      <div style={{ width: '32px', height: '32px', borderRadius: '50%', background: 'var(--color-primary-subtle)' }}></div>
      <div style={{ flex: 1 }}>
        <div style={{ fontWeight: 500 }}>Jane Smith</div>
        <div style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)' }}>jane@example.com</div>
      </div>
      <span style={{ padding: '0.25rem 0.5rem', background: 'var(--color-success-subtle)', color: 'var(--color-success-emphasis)', borderRadius: '4px', fontSize: '0.75rem' }}>Active</span>
    </div>
  </div>

  <div style={{ padding: '1rem', border: '2px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.75rem 0', color: 'var(--color-text-muted)' }}>Card Context</h4>
    <div style={{ padding: '0.75rem', background: 'var(--color-bg-default)', borderRadius: '4px' }}>
      <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', marginBottom: '0.5rem' }}>
        <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: 'var(--color-primary-subtle)' }}></div>
        <div>
          <div style={{ fontWeight: 500 }}>Jane Smith</div>
          <span style={{ padding: '0.125rem 0.375rem', background: 'var(--color-success-subtle)', color: 'var(--color-success-emphasis)', borderRadius: '4px', fontSize: '0.625rem' }}>Active</span>
        </div>
      </div>
      <div style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)' }}>
        <div>jane@example.com</div>
        <div>San Francisco, CA</div>
      </div>
    </div>
  </div>

  <div style={{ padding: '1rem', border: '2px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.75rem 0', color: 'var(--color-text-muted)' }}>Form Context</h4>
    <div style={{ padding: '0.75rem', background: 'var(--color-bg-default)', borderRadius: '4px' }}>
      <div style={{ marginBottom: '0.5rem' }}>
        <label style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)', display: 'block', marginBottom: '0.25rem' }}>Display Name</label>
        <div style={{ padding: '0.375rem 0.5rem', border: '1px solid var(--color-border-default)', borderRadius: '4px', fontSize: '0.875rem' }}>Jane Smith</div>
      </div>
      <div style={{ marginBottom: '0.5rem' }}>
        <label style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)', display: 'block', marginBottom: '0.25rem' }}>Email</label>
        <div style={{ padding: '0.375rem 0.5rem', border: '1px solid var(--color-border-default)', borderRadius: '4px', fontSize: '0.875rem' }}>jane@example.com</div>
      </div>
      <div>
        <label style={{ fontSize: '0.75rem', color: 'var(--color-text-muted)', display: 'block', marginBottom: '0.25rem' }}>Status</label>
        <div style={{ padding: '0.375rem 0.5rem', border: '1px solid var(--color-border-default)', borderRadius: '4px', fontSize: '0.875rem', display: 'flex', justifyContent: 'space-between' }}>Active <span>▼</span></div>
      </div>
    </div>
  </div>

  <div style={{ padding: '1rem', border: '2px solid var(--color-border-default)', borderRadius: '8px' }}>
    <h4 style={{ margin: '0 0 0.75rem 0', color: 'var(--color-text-muted)' }}>Inline Context</h4>
    <div style={{ padding: '0.75rem', background: 'var(--color-bg-default)', borderRadius: '4px' }}>
      <p style={{ margin: 0, fontSize: '0.875rem' }}>
        Assigned to <span style={{ padding: '0.125rem 0.375rem', background: 'var(--color-primary-subtle)', borderRadius: '4px', fontWeight: 500 }}>Jane Smith</span> on Dec 1, 2025
      </p>
    </div>
  </div>
</div>

All four views render the **same User object** with the **same traits**. The context determines what subset of information appears and how it's styled.

---

## Next Steps

Now that you understand the core concepts:

- **[The Trait Engine](/docs/understanding-oods-trait-engine--docs)** — How the compositor merges traits and resolves conflicts
- **[Objects](/docs/objects-object-explorer--docs)** — Explore live object examples
- **[Traits](/docs/traits-how-traits-work--docs)** — Deep dive into specific traits
- **[Contexts](/docs/contexts-same-object-different-contexts--docs)** — See context switching in action

---

<div style={{ marginTop: '2rem', padding: '1rem', background: 'var(--color-bg-subtle)', borderRadius: '8px', fontSize: '0.875rem' }}>
  <strong>Summary:</strong> Objects are your domain entities. Traits are capabilities objects compose. Contexts are rendering situations. Together, they let you define once and render everywhere with automatic consistency.
</div>
