# OODS Foundry v1.0 Migration Guide

Use this guide to upgrade pilot/beta adopters to the v1.0 RC drop captured in `docs/releases/v1.0-release-notes.md`.

## Audience & Goals

- **Audience:** Product pods and platform teams that experimented with pre-v1 traits, tokens, or contexts.
- **Goal:** land on the canonical trait/object registry, adopt the tokens-only contract, and capture release evidence so downstream consumers can trust the artifacts.

## Prerequisites

1. Node 20 + pnpm 9.12 via Corepack (`corepack enable && pnpm i`).
2. Clean working tree with latest `main` checked out.
3. Access to CMOS CLI + database (see `cmos/agents.md`).

## Step 1 — Align on Canonical Traits & Objects

1. Audit existing domain traits/objects against `traits/` and `objects/`.
2. Use `pnpm generate:trait-types` / `pnpm generate:objects` to regenerate types after syncing definitions.
3. Compose your domain objects through `src/core/compositor.ts` or `pnpm object:compose` to verify provenance + collision handling.
4. Document any deltas in `docs/domain/<domain>/` and update `tests/` mirrors accordingly.

## Step 2 — Adopt the Context & Region Contracts

1. Ensure every consumer targets canonical contexts (`List|Detail|Form|Timeline`) and regions per `docs/specs/regions.md`.
2. Refactor modifiers to follow the purity contract in `docs/patterns/modifier-purity.md` (no hooks, no side effects).
3. Update Storybook stories to demonstrate all contexts and high-contrast variants; re-run `pnpm storybook` locally to smoke test.

## Step 3 — Refresh Tokens & Guardrails

1. Normalize brand tokens in `packages/tokens/src/tokens/` (aliases, motion, brand-specific files).
2. Run the full suite:
   ```bash
   pnpm build:tokens
   pnpm tokens:guardrails
   pnpm tokens:governance
   ```
3. Inspect `artifacts/state/governance/brand-*.json` for high-risk entries; apply `token-change:breaking` if required.
4. Capture updated CSS variables (`packages/tokens/dist/variables.css`) for downstream packages.

## Step 4 — Guardrail & Accessibility Evidence

1. Rebuild packages + docs: `pnpm build && pnpm build:packages && pnpm build-storybook`.
2. Rerun automated checks:
   ```bash
   pnpm purity:audit
   pnpm a11y:diff
   pnpm vrt:hc
   pnpm chromatic:dry-run   # supply CHROMATIC_PROJECT_TOKEN
   ```
3. Store a copy of `tools/a11y/reports/a11y-report.json`, Chromatic artifact IDs, and HC captures under `artifacts/`.

## Step 5 — Release Evidence & Packaging

1. Follow `docs/releases/runbook.md` to execute `pnpm release:dry-run` (tarballs, SBOM, provenance, command log).
2. Run `pnpm pack:verify` to confirm deterministic tarballs and diff outputs.
3. Update `docs/releases/v1.0-release-notes.md` + README links if new evidence or highlights emerge.
4. Record compliance status using `docs/compliance/v1-audit-report.md` as the template if additional guardrail sweeps are required.

## Step 6 — CMOS Logging & Telemetry

1. `./cmos/cli.py validate health` before and after migration work.
2. Use `./cmos/cli.py mission update <id> --notes "..."` (or the mission runtime helpers) to capture key decisions.
3. Tail `cmos/telemetry/events/database-health.jsonl` and attach any anomalies to the mission notes.

## Verification Checklist

| Area | Command / Artifact | Status |
|------|-------------------|--------|
| Trait/object parity | `pnpm object:validate`, updated docs | ☐ |
| Context coverage | Updated stories + docs/spec references | ☐ |
| Tokens | `pnpm build:tokens`, guardrail + governance reports | ☐ |
| Guardrails/a11y | `pnpm purity:audit`, `pnpm a11y:diff`, `pnpm vrt:hc`, Chromatic | ☐ |
| Packaging | `pnpm release:dry-run`, SBOM + summary bundle | ☐ |
| CMOS logging | Mission notes + post-run `validate health` + telemetry tail | ☐ |

Complete every row before promoting consumers to the v1.0 packages.
