{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://designlab.local/schemas/repl.render.input.json",
  "title": "Agentic REPL render input",
  "type": "object",
  "properties": {
    "mode": {
      "type": "string",
      "enum": [
        "full",
        "patch"
      ],
      "default": "full"
    },
    "schema": {
      "$ref": "./repl.ui.schema.json"
    },
    "patch": {
      "$ref": "./repl.patch.json"
    },
    "baseTree": {
      "$ref": "./repl.ui.schema.json"
    },
    "researchContext": {
      "type": "object",
      "description": "Optional research bundle from Stage1 discovery to influence rendering.",
      "additionalProperties": true
    },
    "options": {
      "type": "object",
      "properties": {
        "includeTree": {
          "type": "boolean",
          "default": true
        },
        "previewOnly": {
          "type": "boolean",
          "default": false
        }
      },
      "additionalProperties": false,
      "default": {}
    },
    "output": {
      "type": "object",
      "description": "Optional render output controls. Omitting this object preserves full-document behavior.",
      "properties": {
        "format": {
          "type": "string",
          "enum": [
            "document",
            "fragments"
          ],
          "default": "document"
        },
        "strict": {
          "type": "boolean",
          "default": false
        },
        "includeCss": {
          "type": "boolean",
          "default": true
        },
        "depth": {
          "type": "number",
          "description": "Reserved for v2 fragment-depth controls; currently ignored."
        }
      },
      "additionalProperties": false
    },
    "apply": {
      "type": "boolean"
    }
  },
  "required": [
    "mode"
  ],
  "allOf": [
    {
      "if": {
        "properties": {
          "mode": {
            "const": "full"
          }
        }
      },
      "then": {
        "required": [
          "schema"
        ]
      }
    },
    {
      "if": {
        "properties": {
          "mode": {
            "const": "patch"
          }
        }
      },
      "then": {
        "required": [
          "patch"
        ]
      }
    }
  ],
  "additionalProperties": false
}
